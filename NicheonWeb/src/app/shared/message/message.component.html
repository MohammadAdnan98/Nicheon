<div class="chat-container">
  <!-- Top Bar -->
  <div class="top-bar d-flex align-items-center px-3 py-2 shadow-sm">
    <i class="bi bi-arrow-left me-3 back-icon" (click)="goBack()"></i>
    <img [src]="scrap.image" class="scrap-thumb me-2 shadow-sm" alt="scrap" />
    <div>
      <div class="fw-semibold">{{ scrap.title }}</div>
      <div class="small text-muted">
        {{ opponent.businessName }}
        <i *ngIf="opponent.verified" class="bi bi-patch-check-fill text-success ms-1"></i>
      </div>
    </div>
    <div class="ms-auto">
      <button class="btn btn-gold btn-sm" *ngIf="opponent.verified">ðŸ“ž Call</button>
    </div>
  </div>

  <!-- Chat Messages -->
  <div class="chat-body">
    <div class="chat-thread">
      <div
        *ngFor="let msg of messages"
        [ngClass]="{ 'my-msg': msg.isMine, 'their-msg': !msg.isMine }"
        class="chat-bubble"
      >
        <div *ngIf="msg.type === 'text'">{{ msg.text }}</div>
        <img *ngIf="msg.type === 'image'" [src]="msg.imageUrl" class="chat-image" />
        <div *ngIf="msg.type === 'offer'" class="chat-offer">ðŸ’° Offer: â‚¹{{ msg.amount }}</div>
        <div class="chat-meta small text-muted">
          {{ msg.timestamp }}
          <span *ngIf="msg.isMine && msg.read" class="text-success ms-1">âœ“âœ“</span>
        </div>
      </div>

      <div *ngFor="let sys of systemMessages" class="system-msg text-center small text-muted my-2">
        â€” {{ sys }} â€”
      </div>
    </div>

    <!-- Input Bar -->
    <div class="input-bar shadow rounded-pill mx-3 mb-3">
      <input
        type="text"
        class="form-control border-0 rounded-pill"
        [(ngModel)]="newMessage"
        placeholder="Type a message..."
      />
      <i class="bi bi-paperclip text-gold"></i>
      <button class="btn btn-gold rounded-pill px-3" (click)="sendMessage()">Send</button>
    </div>
  </div>
</div>
