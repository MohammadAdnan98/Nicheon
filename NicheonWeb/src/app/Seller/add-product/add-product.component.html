<div class="add-product-container" *ngIf="!loading; else loadingTpl">
  <!-- ðŸŒŸ Header -->
  <div
    class="header d-flex align-items-center justify-content-between px-3 py-3 bg-white shadow-sm rounded"
  >
    <div class="d-flex align-items-center gap-2">
      <button class="btn back-btn" (click)="goBack()">
        <i class="bi bi-arrow-left"></i>
      </button>
      <h4 class="mb-0 fw-semibold text-dark">Add New Product</h4>
    </div>
  </div>

  <!-- âœ¨ Main Form -->
  <form class="container py-4" (ngSubmit)="submitProduct()">
    <div class="row g-4 align-items-start">
      <!-- ðŸ“¸ Image Upload Section -->
      <div class="col-lg-5">
        <div class="image-upload-card card border-0 shadow-sm p-3">
          <div class="main-image-box">
            <img
              [src]="previewImages.length ? previewImages[0] : 'assets/Image/NoImageUploaded.png'"
              class="main-image"
              alt="Preview"
            />
          </div>

          <div class="thumbs d-flex flex-wrap gap-2 mt-3">
            <div
              class="thumb-box"
              *ngFor="let img of previewImages; let i = index"
              [class.primary]="i === 0"
            >
              <img [src]="img" (click)="setPrimary(i)" />
              <button
                type="button"
                class="remove-btn"
                (click)="removeImage(i)"
                title="Remove image"
              >
                Ã—
              </button>
            </div>

            <!-- <label class="thumb-add">
              <input
                type="file"
                multiple
                accept="image/*"
                (change)="onImageUpload($event)"
              />
              <i class="bi bi-plus-lg"></i>
            </label> -->

            <app-file-upload (filesChanged)="onFilesChanged($event)" [maxFiles]="6"></app-file-upload>

          </div>

          <p class="small text-muted mt-2 text-center">
            Upload up to <b>6 images</b>. First image becomes your primary.
          </p>
        </div>
      </div>

      <!-- ðŸ§¾ Product Details Section -->
      <div class="col-lg-7">
        <div class="card border-0 shadow-sm p-4">
          <div class="mb-3">
            <label class="form-label fw-semibold">Product Name *</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="product.productName"
              name="productName"
              required
            />
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Category</label>
              <select
                class="form-select"
                [(ngModel)]="product.categoryId"
                name="categoryId"
              >
                <option [value]="1">Necklace</option>
                <option [value]="2">Ring</option>
                <option [value]="3">Bracelet</option>
                <option [value]="4">Earrings</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Metal Type</label>
              <select
                class="form-select"
                [(ngModel)]="product.metalId"
                name="metalId"
              >
                <option [value]="1">Gold</option>
                <option [value]="2">Silver</option>
                <option [value]="3">Platinum</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Karat</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="product.karat"
                name="karat"
                placeholder="e.g. 22K"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Colour</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="product.colour"
                name="colour"
                placeholder="e.g. Yellow Gold"
              />
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Weight (grams)</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="product.weightGrams"
                name="weightGrams"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Price per Gram (â‚¹)</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="product.pricePerGram"
                name="pricePerGram"
              />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Making Charges (â‚¹)</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="product.makingCharges"
              name="makingCharges"
            />
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">Stock</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="product.stock"
                name="stock"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">MOQ</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="product.moq"
                name="moq"
              />
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Description</label>
            <textarea
              class="form-control"
              rows="3"
              [(ngModel)]="product.description"
              name="description"
            ></textarea>
          </div>

          <div class="form-check mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              id="hallmarkCheck"
              [(ngModel)]="product.isHallmarked"
              name="isHallmarked"
            />
            <label class="form-check-label" for="hallmarkCheck"
              >âœ” Hallmarked Product</label
            >
          </div>

          <div class="mb-3" *ngIf="product.isHallmarked">
            <label class="form-label fw-semibold">Hallmark Number *</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="product.hallmarkNumber"
              name="hallmarkNumber"
              placeholder="Enter Hallmark Certificate Number"
              required
            />
          </div>

          <button class="btn btn-gold w-100 py-2 mt-3" [disabled]="loading">
            {{ loading ? "Saving..." : "Add Product" }}
          </button>
        </div>
      </div>
    </div>
  </form>
</div>

<!-- ðŸŒ€ Loader -->
<ng-template #loadingTpl>
  <div class="text-center py-5">
    <div class="spinner-border text-gold"></div>
    <p class="text-muted mt-2">Saving product...</p>
  </div>
</ng-template>
