<div class="product-detail" *ngIf="!loading; else loadingTpl">
  <!-- Header -->
  <div class="header d-flex align-items-center justify-content-between px-3 py-3 bg-white shadow-sm">
    <div class="d-flex align-items-center gap-2">
      <button class="btn back-btn" (click)="back()"><i class="bi bi-arrow-left"></i></button>
      <div class="crumb small">
        <span class="link" (click)="back()">My Listings</span>
        <span> / </span>
        <span class="text-dark">{{ product?.productName }}</span>
      </div>
    </div>
  </div>

  <div class="container py-4">
    <div class="row g-4 align-items-start">

      <!-- ðŸ“¸ IMAGE GALLERY -->
      <div class="col-12 col-lg-6">
        <div class="gallery card p-3">

          <!-- MAIN IMAGE WITH AMAZON ZOOM -->
          <div class="main-image"
               #zoomContainer
               (mousemove)="onZoom($event)"
               (mouseenter)="enableZoom()"
               (mouseleave)="disableZoom()"
               (touchmove)="onZoom($event)"
               (touchstart)="enableZoom()"
               (touchend)="disableZoom()">

            <img #mainImage [src]="activeImage" alt="Product Image" />

            <!-- Lens -->
            <div class="zoom-lens" *ngIf="zoomEnabled"></div>
          </div>

          <!-- Zoom Result Window -->
          <div class="zoom-result" *ngIf="zoomEnabled"
               [style.backgroundImage]="'url(' + activeImage + ')'">
          </div>

          <!-- THUMBNAILS -->
          <div class="thumbs">
            <img *ngFor="let img of gallery"
                 [src]="img.url"
                 [alt]="img.alt || 'Image'"
                 [class.active]="img.url === activeImage"
                 (click)="selectImage(img)">
          </div>

        </div>
      </div>

      <!-- PRODUCT SUMMARY -->
      <div class="col-12 col-lg-6">
        <div class="summary card p-4">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h4 class="fw-semibold">{{ product?.productName }}</h4>
              <p class="small text-muted mb-2">{{ product?.productCode }}</p>
            </div>
            <div class="text-end">
              <span class="badge" [ngClass]="product?.isActive ? 'bg-success' : 'bg-secondary'">
                {{ product?.isActive ? 'Active' : 'Inactive' }}
              </span>
              <div *ngIf="product?.isHallmarked" class="small text-success mt-1">
                âœ… Hallmarked
              </div>
            </div>
          </div>

          <div class="price-card mt-3">
            <div class="price-item">
              <div class="label">Price / gram</div>
              <div class="value text-gold">â‚¹ {{ pricePerGram }}</div>
            </div>
            <div class="price-item">
              <div class="label">Total Value</div>
              <div class="value text-gold">â‚¹ {{ indicativeTotal }}</div>
              <div class="small text-muted">({{ product?.weightGrams }}g)</div>
            </div>
          </div>

          <div class="spec-grid mt-3">
            <div class="spec" *ngFor="let s of specs">
              <div class="label">{{ s.label }}</div>
              <div class="value">{{ s.value }}</div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button class="btn btn-gold" (click)="editProduct()">Edit</button>
            <button class="btn btn-outline-danger" (click)="deleteProduct()">Delete</button>
            <button class="btn btn-outline-dark ms-auto" (click)="promote()">Promote</button>
          </div>
        </div>
      </div>

      <!-- DESCRIPTION -->
      <div class="col-12">
        <div class="card p-4">
          <h6 class="fw-semibold mb-2">Product Description</h6>
          <p class="text-muted mb-0">{{ product?.description || product?.shortDescription }}</p>
        </div>
      </div>

      <!-- META -->
      <div class="col-12">
        <div class="card p-4 meta-grid">
          <div>
            <div class="label">Category</div>
            <div class="value">{{ product?.categoryName || 'Jewellery' }}</div>
          </div>
          <div>
            <div class="label">Created On</div>
            <div class="value">{{ product?.createdAt | date:'medium' }}</div>
          </div>
          <div>
            <div class="label">Last Updated</div>
            <div class="value">{{ product?.updatedAt ? (product.updatedAt | date:'medium') : '-' }}</div>
          </div>
          <div>
            <div class="label">Hallmark No.</div>
            <div class="value">{{ product?.hallmarkNumber || '-' }}</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- LOADING -->
<ng-template #loadingTpl>
  <div class="text-center py-5">
    <div class="spinner-border text-gold"></div>
    <p class="text-muted mt-2">Loading product details...</p>
  </div>
</ng-template>
