<div class="product-detail" *ngIf="!loading; else loadingTpl">

  <!-- Header / Breadcrumb / Back -->
  <div class="header bg-white border-bottom py-2 px-3 d-flex align-items-center gap-2">
    <button class="btn btn-light btn-sm" (click)="back()">
      <i class="bi bi-arrow-left"></i> Back
    </button>
    <div class="crumb small text-muted">
      <span class="link" (click)="back()">My Listings</span>
      <span> / </span>
      <span class="text-dark">{{ product?.productName }}</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container py-3">
    <div class="row g-4">

      <!-- Gallery -->
      <div class="col-12 col-lg-6">
        <div class="gallery card p-3">
          <div class="main-image">
            <img [src]="activeImage" alt="Product" />
          </div>
          <div class="thumbs mt-2">
            <img *ngFor="let img of gallery"
                 [src]="img.url"
                 [alt]="img.alt || 'Image'"
                 [class.active]="img.url === activeImage"
                 (click)="selectImage(img)"/>
          </div>
        </div>
      </div>

      <!-- Summary / Actions -->
      <div class="col-12 col-lg-6">
        <div class="summary card p-3">
          <div class="d-flex align-items-start justify-content-between">
            <div>
              <h5 class="mb-1">{{ product?.productName }}</h5>
              <div class="small text-muted">{{ product?.productCode }}</div>
            </div>
            <div class="text-end">
              <span class="badge" [ngClass]="product?.isActive ? 'bg-success' : 'bg-secondary'">
                {{ product?.isActive ? 'Active' : 'Inactive' }}
              </span>
              <div *ngIf="product?.isHallmarked" class="small text-success mt-1">
                ✅ Hallmarked
              </div>
            </div>
          </div>

          <!-- Price -->
          <div class="price-row mt-3">
            <div class="price">
              <div class="label">Price / gram</div>
              <div class="value">₹ {{ pricePerGram }}</div>
            </div>
            <div class="price">
              <div class="label">Indicative Total</div>
              <div class="value">₹ {{ indicativeTotal }}</div>
              <div class="muted small">({{ product?.weightGrams }} g)</div>
            </div>
          </div>

          <!-- Specs -->
          <div class="spec-grid mt-3">
            <div class="spec" *ngFor="let s of specs">
              <div class="label">{{ s.label }}</div>
              <div class="value">{{ s.value }}</div>
            </div>
          </div>

          <!-- Actions -->
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary" (click)="editProduct()">Edit</button>
            <button class="btn btn-outline-danger" (click)="deleteProduct()">Delete</button>
            <button class="btn btn-outline-dark ms-auto" (click)="promote()">Promote</button>
          </div>
        </div>
      </div>

      <!-- Description -->
      <div class="col-12">
        <div class="card p-3">
          <h6 class="mb-2">Description</h6>
          <p class="mb-0 text-muted">{{ product?.description || product?.shortDescription }}</p>
        </div>
      </div>

      <!-- Meta / Links -->
      <div class="col-12">
        <div class="card p-3 meta-grid">
          <div>
            <div class="label">Category</div>
            <div class="value">{{ product?.categoryName || 'Jewellery' }}</div>
          </div>
          <div>
            <div class="label">Created</div>
            <div class="value">{{ product?.createdAt | date:'medium' }}</div>
          </div>
          <div>
            <div class="label">Updated</div>
            <div class="value">{{ product?.updatedAt ? (product?.updatedAt | date:'medium') : '-' }}</div>
          </div>
          <div>
            <div class="label">Hallmark No.</div>
            <div class="value">{{ product?.hallmarkNumber || '-' }}</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="text-muted mt-2">Loading product...</p>
  </div>
</ng-template>
