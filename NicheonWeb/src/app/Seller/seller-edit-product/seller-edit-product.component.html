<div class="edit-product-container" *ngIf="!loading; else loadingTpl">

  <!-- üåü Toast (Top Right) -->
<div
  *ngIf="toastMessage"
  class="custom-toast"
  [ngClass]="toastType === 'success' ? 'success' : 'error'"
>
  <i
    class="bi"
    [ngClass]="
      toastType === 'success'
        ? 'bi-check-circle-fill'
        : 'bi-exclamation-circle-fill'
    "
  ></i>

  <div class="toast-content">
    <div class="toast-title">
      {{ toastType === "success" ? "Success" : "Error" }}
    </div>
    <div class="toast-text">{{ toastMessage }}</div>
  </div>
</div>

  
  <!-- üåü Top Bar -->
  <div class="top-bar d-flex justify-content-between align-items-center px-3 py-3 shadow-sm bg-white">
    <div class="d-flex align-items-center gap-2">
      <button class="btn back-btn" (click)="goBack()">
        <i class="bi bi-arrow-left"></i>
      </button>
      <h5 class="mb-0 fw-semibold">‚úèÔ∏è Edit Product</h5>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-danger btn-sm" (click)="confirmDelete()">
        üóë Delete
      </button>

      <button class="btn btn-gold btn-sm" [disabled]="saving" (click)="submitProduct()">
        {{ saving ? "Saving..." : "Save Changes" }}
      </button>
    </div>
  </div>

  <!-- ========================================= -->
  <!-- üì∏ Image Section -->
  <!-- ========================================= -->
  <div class="px-3 pt-3">
    <div class="image-hero">
      <img
        [src]="primaryPreview || 'assets/Image/NoImageUploaded.png'"
        class="main-image shadow-sm"
        alt="Product Image"
      />
    </div>

    <div class="thumbs d-flex flex-wrap gap-2 mt-3">

      <!-- üîÅ All Images (existing + new uploads) -->
      <div
        class="thumb-box"
        *ngFor="let url of previewImages; let i = index"
        [class.primary]="i === primaryIndex"
      >
        <img
          [src]="url"
          class="thumb"
          alt="Preview"
          (click)="setPrimary(i)"
        />

        <!-- üõ† Small Action Icons -->
        <div class="thumb-actions">
          <button
            type="button"
            class="btn-icon"
            title="Set as Primary"
            (click)="setPrimary(i); $event.stopPropagation()"
          >
            <i class="bi" [ngClass]="i === primaryIndex ? 'bi-star-fill text-gold' : 'bi-star'"></i>
          </button>

          <button
            type="button"
            class="btn-icon"
            title="Remove Image"
            (click)="removeImage(i); $event.stopPropagation()"
          >
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
      </div>

      <!-- ‚ûï Add New Images -->
      <label class="thumb-add">
        <input type="file" multiple accept="image/*" (change)="onImageUpload($event)" />
        <i class="bi bi-plus-lg"></i>
      </label>
    </div>

    <p class="small text-muted mt-1">Upload up to 6 images. Click ‚≠ê to set primary.</p>
  </div>

  <!-- ========================================= -->
  <!-- üìù FORM -->
  <!-- ========================================= -->
  <form class="p-3" (ngSubmit)="submitProduct()">
    <div class="card p-4 border-0 shadow-sm form-card">

      <!-- Product Name -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Product Name *</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="product.productName"
          name="productName"
          required
        />
      </div>

      <!-- Category & Metal -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Category</label>
          <select class="form-select" [(ngModel)]="product.categoryId" name="categoryId">
            <option [value]="1">Necklace</option>
            <option [value]="2">Ring</option>
            <option [value]="3">Bracelet</option>
            <option [value]="4">Earrings</option>
          </select>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Metal Type</label>
          <select class="form-select" [(ngModel)]="product.metalId" name="metalId">
            <option [value]="1">Gold</option>
            <option [value]="2">Silver</option>
            <option [value]="3">Platinum</option>
          </select>
        </div>
      </div>

      <!-- Karat & Colour -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Karat</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="product.karat"
            name="karat"
            placeholder="22K"
          />
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Colour</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="product.colour"
            name="colour"
            placeholder="Yellow Gold"
          />
        </div>
      </div>

      <!-- Weight & Price -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Weight (grams)</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="product.weightGrams"
            name="weightGrams"
          />
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Price per Gram (‚Çπ)</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="product.pricePerGram"
            name="pricePerGram"
          />
        </div>
      </div>

      <!-- Making Charges -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Making Charges (‚Çπ)</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="product.makingCharges"
          name="makingCharges"
        />
      </div>

      <!-- Stock & MOQ -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Stock</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="product.stock"
            name="stock"
          />
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">MOQ</label>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="product.moq"
            name="moq"
          />
        </div>
      </div>

      <!-- Hallmark -->
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox"
          [(ngModel)]="product.isHallmarked"
          name="isHallmarked"
        />
        <label class="form-check-label">‚úîÔ∏è Hallmarked Product</label>
      </div>

      <div class="mb-3" *ngIf="product.isHallmarked">
        <label class="form-label fw-semibold">Hallmark Number *</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="product.hallmarkNumber"
          name="hallmarkNumber"
          required
        />
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Description</label>
        <textarea 
          class="form-control"
          rows="3"
          [(ngModel)]="product.description"
          name="description"
        ></textarea>
      </div>

    </div>

    <div class="text-center mt-4">
      <button class="btn btn-gold w-100 py-2" [disabled]="saving">
        {{ saving ? "Saving..." : "üíæ Save Product" }}
      </button>
    </div>
  </form>
</div>

<!-- LOADING TEMPLATE -->
<ng-template #loadingTpl>
  <div class="text-center py-5">
    <div class="spinner-border text-gold"></div>
    <p class="text-muted mt-2">Loading product...</p>
  </div>
</ng-template>
