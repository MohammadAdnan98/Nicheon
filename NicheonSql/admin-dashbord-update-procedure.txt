ALTER PROCEDURE sp_Admin_GetSellers  
    @Status int 
AS
/*
exec sp_Admin_GetSellers 1
*/
BEGIN  
    SET NOCOUNT ON;  
  
    SELECT  
        u.UserId,  
        u.FullName,  
        u.PrimaryEmail,  
        u.PrimaryPhone,  
        u.IsVerified,  
        u.IsActive,  
        b.BusinessId,  
        b.BusinessName,  
        b.BusinessType,  
        b.GSTNumber,  
        b.City,  
        b.State,  
		ps.StatusName as Status,
        b.CreatedAt  
    FROM Users u  
    INNER JOIN BusinessProfiles b ON u.UserId = b.UserId  
	lEFT JOIN ProfileStatusMaster ps ON ps.ProfileStatusId =u.ProfileStatusId
    WHERE u.RoleId = 1 
	AND
	u.ProfileStatusId = @Status AND u.IsActive = 1
    ORDER BY b.CreatedAt DESC;  
END  
  

  GO

    
Alter PROCEDURE sp_Admin_ApproveSeller  
    @UserId INT,  
    @AdminUserId INT  
AS  
BEGIN  
    SET NOCOUNT ON;  
  
    UPDATE Users  
    SET ProfileStatusId = 1  
    WHERE UserId = @UserId AND RoleId =1;  


  
    INSERT INTO AdminAuditLogs  
    (  
        AdminUserId,  
        Action,  
        Entity,  
        EntityId,  
        NewData  
    )  
    VALUES  
    (  
        @AdminUserId,  
        'Approve',  
        'Seller',  
        @UserId,  
        'Approve'  
    );  
END  
  

  GO

  
ALTER PROCEDURE sp_Admin_ToggleSellerStatus  
    @UserId INT,  
    @StatusId INT,  
    @AdminUserId INT  
AS  
BEGIN  
    SET NOCOUNT ON; 
	
	DECLARE @StatusName Nvarchar(50)
  
    UPDATE Users  
    SET ProfileStatusId = @StatusId  
    WHERE UserId = @UserId AND RoleId =1; 

	select @StatusName = StatusName
	from ProfileStatusMaster
	where ProfileStatusId = @StatusId
  
    INSERT INTO AdminAuditLogs  
    (  
        AdminUserId,  
        Action,  
        Entity,  
        EntityId,  
        NewData  
    )  
    VALUES  
    (  
        @AdminUserId,  
        @StatusName,
        'Seller',  
        @UserId,  
        @StatusName  
    );  
END  
  