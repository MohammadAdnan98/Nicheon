ALTER PROCEDURE sp_UpdateBusinessProfile    
    @BusinessId INT,    
    @BusinessName NVARCHAR(255),    
    @BusinessType NVARCHAR(50),    
    @GSTNumber NVARCHAR(32) = NULL,    
    @PAN NVARCHAR(20) = NULL,    
    @FullName NVARCHAR(200) = NULL,    
    @ContactPhone NVARCHAR(20) = NULL,    
    @BusinessEmail NVARCHAR(255) = NULL,    
    @Address NVARCHAR(500) = NULL,    
    @Landmark NVARCHAR(250) = NULL,    
    @City NVARCHAR(100) = NULL,    
    @State NVARCHAR(100) = NULL,    
    @Country NVARCHAR(100) = NULL,    
    @Pincode NVARCHAR(20) = NULL,    
    @OutResult INT OUTPUT    
AS    
BEGIN    
    SET NOCOUNT ON;    

    DECLARE @UserId INT;

    -- ▶️ Get the UserId of this business
    SELECT @UserId = UserId 
    FROM BusinessProfiles 
    WHERE BusinessId = @BusinessId;

    -----------------------------------------
    -- 1️⃣ Update BusinessProfiles Table
    -----------------------------------------
    UPDATE BusinessProfiles
    SET    
        BusinessName   = @BusinessName,    
        BusinessType   = @BusinessType,    
        GSTNumber      = @GSTNumber,    
        PAN            = @PAN,    
        ContactPhone   = @ContactPhone,    
        BusinessEmail  = @BusinessEmail,    
        Address        = @Address,    
        Landmark       = @Landmark,    
        City           = @City,    
        State          = @State,    
        Country        = @Country,    
        Pincode        = @Pincode,    
        UpdatedAt      = GETDATE()
    WHERE BusinessId = @BusinessId;

    -----------------------------------------
    -- 2️⃣ Update Users Table (FullName only)
    -----------------------------------------
    IF @UserId IS NOT NULL
    BEGIN
        UPDATE Users
        SET 
            FullName   = @FullName,
            PrimaryEmail = @BusinessEmail,
            PrimaryPhone = @ContactPhone,
            UpdatedAt = GETDATE()
        WHERE UserId = @UserId;
    END

    -- Return status result
    SET @OutResult = 1;
END

GO

ALTER TABLE BusinessProfiles
ADD ProfileLogo NVARCHAR(1000);

GO

ALTER PROCEDURE sp_GetBusinessProfileById  
    @BusinessId INT  
AS  
/*
exec sp_GetBusinessProfileById 1
*/
BEGIN  
    SET NOCOUNT ON;  
  
    SELECT  
        bp.BusinessId,  
        bp.UserId,  
        us.FullName,  
        bp.BusinessName,  
        bp.BusinessType,  
        bp.GSTNumber,  
        bp.PAN,  
        bp.ContactPerson,  
        bp.ContactPhone,  
        bp.BusinessEmail,  
        bp.Address,  
        bp.Landmark,  
        bp.City,  
        bp.State,  
        bp.Country,  
        bp.Pincode,  
        bp.IsVerified,  
        bp.CreatedAt,  
        bp.UpdatedAt,  
        bp.IsActive,
		bp.ProfileLogo
    FROM BusinessProfiles bp  
 LEFT JOIN Users us on us.UserId=bp.UserId  
    WHERE BusinessId = @BusinessId;  
END

